{
  "paragraphs": [
    {
      "text": "%spark \nimport kafka.serializer.StringDecoder\n//import com.datastax.spark.connector.streaming._\n//import org.apache.spark.streaming.{Seconds, StreamingContext}\n//import org.apache.spark.{TaskContext, SparkConf}\nimport org.apache.spark.streaming._\nimport org.apache.spark.streaming.kafka.{OffsetRange, HasOffsetRanges, KafkaUtils}\nimport org.apache.spark.sql._\nimport org.apache.spark.sql.types._\nimport org.apache.spark.sql.functions._\n\nimport sqlContext.implicits._\nimport spark.implicits._\nimport java.util.UUID\n\nval ssc \u003d new StreamingContext(sc, Seconds(5))\nimport com.datastax.spark.connector.streaming._\n//val sqlContext \u003d new SQLContext(sc)",
      "dateUpdated": "Sep 2, 2016 6:41:59 AM",
      "config": {
        "tableHide": false,
        "colWidth": 12.0,
        "editorMode": "ace/mode/scala",
        "editorHide": false,
        "graph": {
          "mode": "table",
          "height": 300.0,
          "optionOpen": false,
          "keys": [],
          "values": [],
          "groups": [],
          "scatter": {},
          "map": {
            "baseMapType": "Streets",
            "isOnline": true,
            "pinCols": []
          }
        },
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "apps": [],
      "jobName": "paragraph_1472629185346_-1341830746",
      "id": "20160726-065534_1308137064",
      "result": {
        "code": "SUCCESS",
        "type": "TEXT",
        "msg": "\nimport kafka.serializer.StringDecoder\n\nimport org.apache.spark.streaming._\n\nimport org.apache.spark.streaming.kafka.{OffsetRange, HasOffsetRanges, KafkaUtils}\n\nimport org.apache.spark.sql._\n\nimport org.apache.spark.sql.types._\n\nimport org.apache.spark.sql.functions._\n\nimport sqlContext.implicits._\n\nimport spark.implicits._\n\nimport java.util.UUID\n\nssc: org.apache.spark.streaming.StreamingContext \u003d org.apache.spark.streaming.StreamingContext@5afd4ac5\n\nimport com.datastax.spark.connector.streaming._\n"
      },
      "dateCreated": "Aug 31, 2016 7:39:45 AM",
      "dateStarted": "Sep 2, 2016 6:41:59 AM",
      "dateFinished": "Sep 2, 2016 6:42:15 AM",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%spark \n  val generateUUID \u003d udf(() \u003d\u003e UUID.randomUUID().toString)    \n\n  val topicsSet \u003d Set(\"my_topic\")\n  val brokers \u003d sys.env(\"KAFKA_ADDRESS\")\n  val kafkaParams \u003d Map[String, String](\"metadata.broker.list\" -\u003e brokers)\n  val messages \u003d KafkaUtils.createDirectStream[String, String, StringDecoder, StringDecoder](ssc, kafkaParams, topicsSet)\n  val schema \u003d StructType(StructField(\"name\",StringType,false)::StructField(\"value\", IntegerType, false)::StructField(\"time\", TimestampType, false)::Nil)\n  //sqlContext.createExternalTable(\"bTable\", \"parquet\", schema, Map(\"path\" -\u003e \"/usr/zeppelin/data/\"))\n  //val df \u003d sqlContext.createExternalTable(\"bigTable\",\"/usr/zeppelin/data/bigTable\")\n  //df.schema(schema)\n  messages.foreachRDD { (rdd,time) \u003d\u003e\n//        println(time)\n        val t \u003d time.milliseconds\n        val dataDF \u003d sqlContext.read.json(rdd.map(_._2)).withColumn(\"time\", lit(t).cast(\"timestamp\")).withColumn(\"id\", generateUUID())\n//        dataDF.printSchema()\n        dataDF.createOrReplaceTempView(\"mytable\")\n        \n        dataDF.write.format(\"parquet\").mode(\"append\").save(\"/usr/zeppelin/data/datalake.parquet\")\n        val allValues \u003d sqlContext.sql(\"select name as prod, value, time as timestamp, id  from mytable \")\n        allValues.write.format(\"org.apache.spark.sql.cassandra\").option(\"header\",\"false\").mode(\"append\").options(Map( \"table\" -\u003e \"all_results\", \"keyspace\" -\u003e \"mio\")).save()\n        val averageValues \u003d sqlContext.sql(\"select name as prod, AVG(value) as average, first(time) as timestamp from mytable group by name\")\n        averageValues.show()\n        averageValues.write.format(\"org.apache.spark.sql.cassandra\").option(\"header\",\"false\").mode(\"overwrite\").options(Map( \"table\" -\u003e \"results\", \"keyspace\" -\u003e \"mio\")).save()\n//        sqlContext.parquetFile( \"/usr/zeppelin/data/datalake.parquet\" )\n//          .coalesce(6)\n//          .write.parquet(\"/usr/zeppelin/data/all.parquet\")\n  }\n// Start the computation\nssc.start()\n//ssc.awaitTerminationOrTimeout(30 * 1000)\n",
      "dateUpdated": "Sep 2, 2016 6:41:59 AM",
      "config": {
        "tableHide": false,
        "colWidth": 12.0,
        "editorMode": "ace/mode/scala",
        "editorHide": false,
        "graph": {
          "mode": "table",
          "height": 111.0,
          "optionOpen": false,
          "keys": [],
          "values": [],
          "groups": [],
          "scatter": {},
          "map": {
            "baseMapType": "Streets",
            "isOnline": true,
            "pinCols": []
          }
        },
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "apps": [],
      "jobName": "paragraph_1472629185386_-1357220702",
      "id": "20160726-072729_926033663",
      "result": {
        "code": "SUCCESS",
        "type": "TEXT",
        "msg": "\ngenerateUUID: org.apache.spark.sql.expressions.UserDefinedFunction \u003d UserDefinedFunction(\u003cfunction0\u003e,StringType,Some(List()))\n\ntopicsSet: scala.collection.immutable.Set[String] \u003d Set(my_topic)\n\nbrokers: String \u003d kafka:9092\n\nkafkaParams: scala.collection.immutable.Map[String,String] \u003d Map(metadata.broker.list -\u003e kafka:9092)\n\nmessages: org.apache.spark.streaming.dstream.InputDStream[(String, String)] \u003d org.apache.spark.streaming.kafka.DirectKafkaInputDStream@6b32947a\n\nschema: org.apache.spark.sql.types.StructType \u003d StructType(StructField(name,StringType,false), StructField(value,IntegerType,false), StructField(time,TimestampType,false))\n"
      },
      "dateCreated": "Aug 31, 2016 7:39:45 AM",
      "dateStarted": "Sep 2, 2016 6:42:03 AM",
      "dateFinished": "Sep 2, 2016 6:42:19 AM",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%sql select name as prod, value, time as timestamp, id  from mytable",
      "dateUpdated": "Sep 2, 2016 6:45:25 AM",
      "config": {
        "colWidth": 12.0,
        "editorMode": "ace/mode/sql",
        "helium": {},
        "graph": {
          "mode": "multiBarChart",
          "height": 168.0,
          "optionOpen": false,
          "keys": [
            {
              "name": "prod",
              "index": 0.0,
              "aggr": "sum"
            }
          ],
          "values": [
            {
              "name": "value",
              "index": 1.0,
              "aggr": "sum"
            }
          ],
          "groups": [],
          "scatter": {
            "yAxis": {
              "name": "value",
              "index": 1.0,
              "aggr": "sum"
            }
          },
          "map": {
            "baseMapType": "Streets",
            "isOnline": true,
            "pinCols": []
          }
        },
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "apps": [],
      "jobName": "paragraph_1472629185388_-1359529196",
      "id": "20160726-094150_302242907",
      "result": {
        "code": "SUCCESS",
        "type": "TABLE",
        "msg": "prod\tvalue\ttimestamp\tid\nprod4\t795\t48641-02-18 11:33:20.0\t511ff5f7-93db-471d-b7e7-2f03d66922d5\nprod3\t870\t48641-02-18 11:33:20.0\t542edffe-f01c-49a2-b562-7ae64c878b1f\nprod4\t399\t48641-02-18 11:33:20.0\t72e8dc1d-eb08-4602-a351-0a2000b057a4\nprod1\t841\t48641-02-18 11:33:20.0\tb285fb1c-ec77-4f98-8b00-57668e447aae\nprod4\t334\t48641-02-18 11:33:20.0\t7ebe98b8-4cae-4d75-8c05-3b0e39d62a42\nprod2\t362\t48641-02-18 11:33:20.0\t127585e2-9ab0-4bbf-bc46-6a5f6023b54e\nprod1\t348\t48641-02-18 11:33:20.0\t0c667ee2-8e06-44c6-a5b3-1898bb24ee67\nprod2\t164\t48641-02-18 11:33:20.0\t8c7b6d2c-549d-4121-84de-e4c8a96c121d\nprod2\t618\t48641-02-18 11:33:20.0\t91f2d522-b82a-47e8-852d-c2f63af56ad6\nprod2\t804\t48641-02-18 11:33:20.0\t7c641ae3-8931-4a6d-8222-087aa7ca9f9e\nprod2\t647\t48641-02-18 11:33:20.0\t88b1b4b6-5fc3-4929-8d59-0e16cd17d79e\nprod3\t618\t48641-02-18 11:33:20.0\t90ae4c42-31eb-4096-912c-2f489c2a54bf\nprod4\t810\t48641-02-18 11:33:20.0\tbf8e6232-1c04-4d84-b8cb-ecdf8dbe6ff1\nprod3\t384\t48641-02-18 11:33:20.0\t7f34ee78-59f5-4320-b152-2dadfae71612\nprod3\t393\t48641-02-18 11:33:20.0\t8cfe8f5f-2023-4815-ab24-1e8d85dcf3bd\nprod3\t330\t48641-02-18 11:33:20.0\tabae0d8d-3bd2-405e-a088-3814c5031641\nprod1\t514\t48641-02-18 11:33:20.0\t1309e266-84d4-4da9-986c-adb66ca8e58a\nprod3\t779\t48641-02-18 11:33:20.0\tbd98c88b-6244-4758-98be-1932ae69ad84\nprod2\t331\t48641-02-18 11:33:20.0\tc6aa66ee-e7b5-403b-98ef-4dd2658ed52b\nprod3\t40\t48641-02-18 11:33:20.0\tec7ab3b3-d864-48cb-b1fd-b6c186a8b655\nprod4\t431\t48641-02-18 11:33:20.0\t729ea567-d76e-4682-9d8c-e7b13e457f59\nprod2\t322\t48641-02-18 11:33:20.0\tb8818fac-a5d6-4e5c-a22b-a2e59933034e\nprod2\t768\t48641-02-18 11:33:20.0\t9cf913ea-b9fb-425f-b31c-299e7b697e1c\nprod3\t750\t48641-02-18 11:33:20.0\t367af561-8014-4aa1-ae95-12a6f3b16c06\nprod4\t244\t48641-02-18 11:33:20.0\t41d65d69-9e85-4267-8111-c67598fecd2f\nprod2\t49\t48641-02-18 11:33:20.0\tfd556634-a5c3-4566-9e22-ff004368a578\nprod3\t774\t48641-02-18 11:33:20.0\t1bc70df8-67ca-46dd-84f3-d8cccc6a07f2\nprod1\t562\t48641-02-18 11:33:20.0\t6cb4accc-4a36-4b95-abd5-b1756d784b8c\nprod3\t577\t48641-02-18 11:33:20.0\t4a44d1e9-2a9e-4888-9a5a-a5c2094c2526\nprod1\t992\t48641-02-18 11:33:20.0\t812fa952-729c-4f2f-be5f-b4dec24e27fc\nprod3\t139\t48641-02-18 11:33:20.0\t881ff9e1-972a-484f-b463-26aae302e37f\nprod4\t180\t48641-02-18 11:33:20.0\t919ce17c-03ab-42f0-87d8-f5fea7fa5004\nprod2\t100\t48641-02-18 11:33:20.0\tf7d5a3cf-2799-4274-ad0b-86d69a936203\nprod1\t757\t48641-02-18 11:33:20.0\t599017ef-5938-4559-a5fc-68473dfcee11\nprod3\t617\t48641-02-18 11:33:20.0\t46254145-d225-4046-96b8-3003207178dd\nprod4\t6\t48641-02-18 11:33:20.0\tf92607cd-e5ef-4792-91ac-34d0d808be12\nprod2\t457\t48641-02-18 11:33:20.0\tf759abcd-287f-4fd2-8daf-755d10e795d8\nprod2\t86\t48641-02-18 11:33:20.0\t2596831e-d76a-43f7-92f5-007eb2f342ba\nprod4\t892\t48641-02-18 11:33:20.0\t1f0c26e0-8ce3-40df-a24d-bfd8783822d5\nprod2\t28\t48641-02-18 11:33:20.0\tf144f4ce-c8f1-4c44-bd4a-052582ec29c4\nprod3\t763\t48641-02-18 11:33:20.0\t11e9ccf9-ab06-43d2-b4d1-4e3d55a2157c\nprod2\t389\t48641-02-18 11:33:20.0\tdea7189b-aa69-49b0-9edb-6558bd9859c7\nprod2\t448\t48641-02-18 11:33:20.0\t8f866b01-6dc3-46e8-91b5-aac60fcba435\nprod1\t604\t48641-02-18 11:33:20.0\t03d7d2df-1782-4682-8d1f-bc7f6304e322\nprod2\t307\t48641-02-18 11:33:20.0\t66162d0b-5c36-4a4c-93c8-462613077b90\nprod4\t868\t48641-02-18 11:33:20.0\t66426991-a30c-4be4-a306-da74c007885b\nprod3\t365\t48641-02-18 11:33:20.0\t3fdae87a-1ced-4e1a-bd3b-c0edd12acf55\nprod2\t973\t48641-02-18 11:33:20.0\t35df21af-750d-4ea5-b6e5-713e3832546f\nprod3\t157\t48641-02-18 11:33:20.0\t341b7198-a46d-46c4-bef6-de2d23591583\nprod4\t704\t48641-02-18 11:33:20.0\td4f2a20a-d559-4c38-8709-5b7554ac4e9d\n"
      },
      "dateCreated": "Aug 31, 2016 7:39:45 AM",
      "dateStarted": "Sep 2, 2016 6:45:22 AM",
      "dateFinished": "Sep 2, 2016 6:45:22 AM",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%spark \nval mydf \u003dsqlContext.sql(\"select * from mytable\")\nmydf.show()\n//ssc.awaitTerminationOrTimeout(30 * 1000)\n//ssc.stop(stopSparkContext\u003dtrue, stopGracefully\u003dtrue)",
      "dateUpdated": "Sep 2, 2016 6:45:32 AM",
      "config": {
        "tableHide": true,
        "colWidth": 12.0,
        "editorMode": "ace/mode/scala",
        "editorHide": false,
        "graph": {
          "mode": "table",
          "height": 300.0,
          "optionOpen": false,
          "keys": [],
          "values": [],
          "groups": [],
          "scatter": {},
          "map": {
            "baseMapType": "Streets",
            "isOnline": true,
            "pinCols": []
          }
        },
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "apps": [],
      "jobName": "paragraph_1472629185389_-1359913945",
      "id": "20160726-082126_24115141",
      "result": {
        "code": "SUCCESS",
        "type": "TEXT",
        "msg": "\nmydf: org.apache.spark.sql.DataFrame \u003d [name: string, value: bigint ... 2 more fields]\n+-----+-----+--------------------+--------------------+\n| name|value|                time|                  id|\n+-----+-----+--------------------+--------------------+\n|prod4|  749|48641-02-18 14:20...|9e108c77-b12a-474...|\n|prod1|   39|48641-02-18 14:20...|cccef68d-24eb-490...|\n|prod1|  783|48641-02-18 14:20...|44165074-6def-492...|\n|prod3|  618|48641-02-18 14:20...|40763bb0-110a-478...|\n|prod2|  758|48641-02-18 14:20...|e6002930-1f6d-45e...|\n|prod2|  931|48641-02-18 14:20...|733fab79-f78f-403...|\n|prod3|  664|48641-02-18 14:20...|1a6aa2af-e868-485...|\n|prod4|  377|48641-02-18 14:20...|4cfc6c83-7eb3-420...|\n|prod3|  514|48641-02-18 14:20...|4402bf9a-e23e-400...|\n|prod3|  740|48641-02-18 14:20...|c67a8255-8b32-476...|\n|prod4|  120|48641-02-18 14:20...|e77e75dc-b4ea-4f9...|\n|prod2|  255|48641-02-18 14:20...|f1219da8-d8d6-4f4...|\n|prod3|  237|48641-02-18 14:20...|ce54852e-b412-464...|\n|prod1|  832|48641-02-18 14:20...|2ce28a2f-19bd-4ce...|\n|prod1|  103|48641-02-18 14:20...|7574be67-50ea-444...|\n|prod2|  429|48641-02-18 14:20...|b9516557-ccdb-472...|\n|prod2|  861|48641-02-18 14:20...|085c807c-ec69-407...|\n|prod2|   36|48641-02-18 14:20...|48c7e34c-bb3e-483...|\n|prod3|  905|48641-02-18 14:20...|dd0f49b2-64b9-428...|\n|prod1|  703|48641-02-18 14:20...|917d3d06-361e-4b4...|\n+-----+-----+--------------------+--------------------+\nonly showing top 20 rows\n\n"
      },
      "dateCreated": "Aug 31, 2016 7:39:45 AM",
      "dateStarted": "Sep 2, 2016 6:45:32 AM",
      "dateFinished": "Sep 2, 2016 6:45:33 AM",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    },
    {
      "text": "%spark ",
      "dateUpdated": "Sep 2, 2016 6:41:59 AM",
      "config": {
        "colWidth": 12.0,
        "editorMode": "ace/mode/scala",
        "graph": {
          "mode": "table",
          "height": 300.0,
          "optionOpen": false,
          "keys": [],
          "values": [],
          "groups": [],
          "scatter": {},
          "map": {
            "baseMapType": "Streets",
            "isOnline": true,
            "pinCols": []
          }
        },
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "apps": [],
      "jobName": "paragraph_1472629185390_-1358759698",
      "id": "20160726-144125_667601238",
      "result": {
        "code": "SUCCESS",
        "type": "TEXT",
        "msg": ""
      },
      "dateCreated": "Aug 31, 2016 7:39:45 AM",
      "dateStarted": "Sep 2, 2016 6:42:20 AM",
      "dateFinished": "Sep 2, 2016 6:42:21 AM",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500
    }
  ],
  "name": "Streaming2",
  "id": "2BVH2Y24H",
  "lastReplName": {
    "value": "spark"
  },
  "angularObjects": {
    "2BW92AJ26:shared_process": [],
    "2BUE7YEUC:shared_process": [],
    "2BWYTCJZC:shared_process": [],
    "2BX6TPWNA:shared_process": [],
    "2BVS7W5AE:shared_process": [],
    "2BV15NK82:shared_process": [],
    "2BUVCFMWC:shared_process": [],
    "2BX44T9KJ:shared_process": [],
    "2BUQNY71C:shared_process": []
  },
  "config": {},
  "info": {}
}